"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2373],{2373:(j,h,c)=>{c.r(h),c.d(h,{ProfilePageModule:()=>C});var d=c(8834),u=c(4341),i=c(7125),p=c(5528),f=c(8041),o=c(9498),P=c(3656);function b(e,l){if(1&e&&o.nrm(0,"ion-progress-bar",11),2&e){const r=o.XpG();o.Y8G("value",r.progressValue)}}function k(e,l){if(1&e){const r=o.RV6();o.j41(0,"ion-item")(1,"ion-label")(2,"h3"),o.EFF(3),o.k0s(),o.j41(4,"p"),o.EFF(5),o.k0s()(),o.j41(6,"ion-button",12),o.bIt("click",function(){const n=o.eBV(r).$implicit,s=o.XpG();return o.Njj(s.deleteSong(n))}),o.nrm(7,"ion-icon",13),o.k0s()()}if(2&e){const r=l.$implicit;o.R7$(3),o.JRh(r.url),o.R7$(2),o.JRh(r.artist)}}function v(e,l){1&e&&(o.j41(0,"div",14)(1,"p"),o.EFF(2,"No tienes canciones descargadas a\xfan."),o.k0s()())}let m=(()=>{var e;class l{constructor(t,n){this.http=t,this.navCtrl=n,this.downloadedSongs=[],this.token=null,this.newSongUrl="",this.apiUrl="http://127.0.0.1:8000/api/",this.isConverting=!1,this.progressValue=0}ngOnInit(){this.loadToken(),this.loadDownloadedSongs()}loadToken(){this.token=localStorage.getItem("access_token"),this.token||console.error("No hay token disponible. El usuario no est\xe1 autenticado.")}loadDownloadedSongs(){if(!this.token)return void console.error("Token no disponible");const t=new f.b({Authorization:`Bearer ${this.token}`});this.http.get("http://127.0.0.1:8000/api/songs/",{headers:t}).subscribe(n=>{console.log("Canciones descargadas desde la API:",n),this.downloadedSongs=n||[],localStorage.setItem("downloadedSongs",JSON.stringify(this.downloadedSongs))},n=>{console.error("Error al obtener las canciones descargadas",n)})}deleteSong(t){const n=localStorage.getItem("access_token");if(!n)return void console.error("Token no disponible, el usuario no esta autenticado");const s=new f.b({Authorization:`Bearer ${n}`});this.http.delete(`${this.apiUrl}songs/delete/${t.id}/`,{headers:s}).subscribe(g=>{console.log("Cancion eliminada correctamente",g),this.downloadedSongs=this.downloadedSongs.filter(a=>a.id!==t.id),localStorage.setItem("downloadedSongs",JSON.stringify(this.downloadedSongs))},g=>{console.error("Error al eliminar la cancion",g)})}convertSong(){if(this.newSongUrl){const t=localStorage.getItem("access_token");if(!t)return void console.error("No hay token disponible. El usuario no est\xe1 autenticado.");const n=new f.b({Authorization:`Bearer ${t}`,"Content-Type":"application/json"}),s={youtube_url:this.newSongUrl};this.isConverting=!0,this.progressValue=0,this.http.post(this.apiUrl+"songs/download/",s,{headers:n}).subscribe(a=>{console.log("Canci\xf3n convertida y guardada:",a),a.song&&this.downloadedSongs.push({title:a.song.title,artist:a.song.artist,url:a.song}),this.isConverting=!1,this.progressValue=1,this.newSongUrl=""},a=>{console.error("Error al convertir y guardar la canci\xf3n:",a),this.isConverting=!1,this.progressValue=1});let g=setInterval(()=>{this.progressValue<1?this.progressValue+=.05:clearInterval(g)},500)}else console.error("Por favor ingresa una URL de canci\xf3n de YouTube")}logout(){localStorage.removeItem("access_token"),this.navCtrl.navigateRoot("/auth")}home(){this.navCtrl.navigateForward("/home")}}return(e=l).\u0275fac=function(t){return new(t||e)(o.rXU(f.a),o.rXU(P.q9))},e.\u0275cmp=o.VBU({type:e,selectors:[["app-profile"]],decls:22,vars:3,consts:[["noSongs",""],["slot","start"],[3,"click"],["slot","end"],["name","log-out-outline"],[1,"ion-padding"],[1,"profile-container"],[3,"value",4,"ngIf"],["placeholder","Ingresa la URL de YouTube",3,"ngModelChange","ngModel"],["expand","full",3,"click"],[4,"ngFor","ngForOf"],[3,"value"],["color","danger","fill","outline",3,"click"],["name","trash-outline"],[1,"no-songs"]],template:function(t,n){if(1&t){const s=o.RV6();o.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-button",1)(3,"ion-button",2),o.bIt("click",function(){return o.eBV(s),o.Njj(n.home())}),o.j41(4,"ion-title"),o.EFF(5,"\u{1f3a7} Mi Perfil"),o.k0s()()(),o.j41(6,"ion-buttons",3)(7,"ion-button",2),o.bIt("click",function(){return o.eBV(s),o.Njj(n.logout())}),o.nrm(8,"ion-icon",4),o.k0s()()()(),o.j41(9,"ion-content",5)(10,"div",6)(11,"h2"),o.EFF(12,"Mis Canciones Descargadas"),o.k0s(),o.DNE(13,b,1,1,"ion-progress-bar",7),o.j41(14,"ion-item")(15,"ion-input",8),o.mxI("ngModelChange",function(a){return o.eBV(s),o.DH7(n.newSongUrl,a)||(n.newSongUrl=a),o.Njj(a)}),o.k0s()(),o.j41(16,"ion-button",9),o.bIt("click",function(){return o.eBV(s),o.Njj(n.convertSong())}),o.EFF(17,"Convertir y Guardar"),o.k0s(),o.j41(18,"ion-list"),o.DNE(19,k,8,2,"ion-item",10),o.k0s()(),o.DNE(20,v,3,0,"ng-template",null,0,o.C5r),o.k0s()}2&t&&(o.R7$(13),o.Y8G("ngIf",n.isConverting),o.R7$(2),o.R50("ngModel",n.newSongUrl),o.R7$(4),o.Y8G("ngForOf",n.downloadedSongs))},dependencies:[d.D,d.G,d.I,i.bv,i.Jm,i.QW,i.W9,i.eU,i.iq,i.$w,i.uz,i.he,i.nf,i.FH,i.BC,i.ai,i.Gw,u.YN,u.BC,u.vS],styles:["ion-content[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #1a1a1a, #303030)}.profile-container[_ngcontent-%COMP%]{text-align:center;color:#fff}ion-item[_ngcontent-%COMP%]{background:#ffffff1a;border-radius:10px;margin-bottom:10px}"]}),l})();const _=[{path:"",component:m}];let S=(()=>{var e;class l{}return(e=l).\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[p.m.forChild(_),p.m]}),l})(),C=(()=>{var e;class l{}return(e=l).\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[d.D,u.YN,i.bv,S,m]}),l})()}}]);